{% extends 'common/base.html' %}
{% block title %}Invite Team{% endblock %}

{% block content %}
<head>
    <link rel="stylesheet" type="text/css" href="/static/style/invite.css">

</head> 

<div class="content">
    <h4 class="title1">Developer</h4>
    <table class="table in_progress_pbi_list" style="width:80%">
        <!--Table head-->
        <thead>
        <tr>
            <th width="20%">Name</th>
            <th width="45%">Email</th>
            <th width="5%">Invited</th>
            <th width="10%">Select</th>
        </tr>
        </thead>
        <!--Table head-->
        <!--Table body-->
        {% for z in dev %}
        <tbody style="background-color: burlywood;">
            <tr class="in_progress_pbi">
            <td scope="row">{{z.name}}</td>
            <td>{{z.email}}</td>
            <td>No</td>
            <td> <input type= 'checkbox'name="user_id" value="{{z.user_id}}"></td>
            </tr>
        </tbody>
        {% endfor %}

        {% for z in dev_invited %}
        <tbody style="background-color: burlywood;">
            <tr class="in_progress_pbi">
            <td scope="row">{{z.name}}</td>
            <td>{{z.email}}</td>
            <td>Yes</td>
            <td> <input type= 'checkbox'name="user_id" value="{{z.user_id}}" disabled></td>
            </tr>
        </tbody>
        {% endfor %}  
    </table>
    <!--Table-->
    {% for z in dev_exist %}
    <h4>{{ z }}</h4>
    {% endfor %}  
    <h4 class="title1">Scrum Master</h4>
    <table class="table in_progress_pbi_list" style="width:80%">
        <!--Table head-->
        <thead>
        <tr>
            <th width="20%">Name</th>
            <th width="45%">Email</th>
            <th width="5%">Invited</th>
            <th width="10%">Select</th>
        </tr>
        </thead>
        <!--Table head-->
        <!--Table body-->
        {% for i in scrum_master %}
        <tbody style="background-color:rgb(212, 161, 161);">
            <tr class="in_progress_pbi">
            <td scope="row">{{i.name}}</td>
            <td>{{i.email}}</td>
            <td>No</td>
            {% if scrum_master_invited == "" and scrum_master_exist == ""%}
            <td> <input type= 'checkbox' class="smcheckbox" name="user_id" value="{{i.user_id}}" ></td>
            {% else %}
            <td> <input type= 'checkbox' name="user_id" value="{{i.user_id}}" disabled></td>
            {% endif %}
            </tr>
        </tbody>
        {% endfor %}

        {% if scrum_master_invited != "" %}
        <tbody style="background-color:rgb(212, 161, 161);">
            <tr class="in_progress_pbi">
            <td scope="row">{{scrum_master_invited.name}}</td>
            <td>{{scrum_master_invited.email}}</td>
            <td>Yes</td>
            <td> <input type= 'checkbox' name="user_id" value="{{i.user_id}}" disabled></td>
            </tr>
        </tbody>
        {% endif %}
    </table>

    {% if scrum_master_exist != "" %}
        <h4>{{ scrum_master_exist }}</h4>
    {% endif %}

    <!--Table-->
    <button type="submit" class="send" name="send" onclick="sendInvites()">Invite</button> 
    <input type="hidden" id="project_id_" value={{project_id}}>

    
    <h2 class="container1">Current Team</h2>
   
    <h4 class="title1">Developer</h4>
    <table class="table in_progress_pbi_list" style="width:80%;">
        <!--Table head-->
        <thead>
        <tr>
            <th width="20%">Name</th>
            <th width="45%">Email</th>
            <th width="10%">Invited</th>
        </tr>
        </thead>
        <!--Table head-->
        <!--Table body-->
        
        <tbody style="background-color: burlywood;">
            <tr class="in_progress_pbi">
            <td scope="row"> Foo Zhi Qian</td>
            <td>Foo@gmail.com</td>
            <td>Yes</td>
            </tr>
        </tbody>
       

    </table>
    <!--Table-->
    
    <h4 class="title1">Scrum Master</h4>
    <table class="table in_progress_pbi_list" style="width:80%">
        <!--Table head-->
        <thead>
        <tr>
            <th width="20%">Name</th>
            <th width="45%">Email</th>
            <th width="10%">Invited</th>
        </tr>
        </thead>
        <!--Table head-->
        <!--Table body-->
       
        <tbody style="background-color:rgb(212, 161, 161);">
            <tr class="in_progress_pbi">
            <td scope="row">Foo Zhi Qian</td>
            <td>zqfoo@gmail.com</td>
            <td>Yes</td>
            </tr>
        </tbody>
      </table>

    

</div>

<script>
    $('.smcheckbox').on('change', function() {
        $('.smcheckbox').not(this).prop('checked', false);  
    });
    
    function sendInvites(){
        var checked_user_id = document.querySelectorAll('input[name=user_id]:checked');
        var checked_user_id2 = [];
        for (var x = 0; x < checked_user_id.length; x++){
            checked_user_id2[x] = checked_user_id[x].value;
        }
        $.ajaxSetup({
            headers: { "X-CSRFToken": '{{csrf_token}}' }
        });

        $.ajax({
            type: "POST",
            url: "{% url 'application:add_to_team' %}",
            data: {
                "user_id_s": JSON.stringify(checked_user_id2),
                "project_id": {{project_id}}
            },
            dataType: 'json',
            success: function(result){
                window.location="{% url 'application:all_project_list' %}"
            }
        });
    }



</script>

{% endblock %}
